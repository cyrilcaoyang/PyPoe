<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings & Configuration - PyPoe</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .settings-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
            min-height: 100vh;
            overflow-y: auto;
            height: 100vh;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        
        .settings-header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .settings-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .settings-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-card h3 i {
            color: #3498db;
            font-size: 1.2rem;
        }
        
        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .config-item:last-child {
            border-bottom: none;
        }
        
        .config-label {
            font-weight: 600;
            color: #5a6c7d;
        }
        
        .config-value {
            color: #2c3e50;
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-online {
            background: #d4edda;
            color: #155724;
        }
        
        .status-enabled {
            background: #cce7ff;
            color: #0056b3;
        }
        
        .status-disabled {
            background: #f8d7da;
            color: #721c24;
        }
        
        .bot-list {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        
        .bot-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .bot-item:last-child {
            border-bottom: none;
        }
        
        .bot-item i {
            color: #3498db;
        }
        
        .api-endpoint {
            background: #2c3e50;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            margin: 4px 0;
            display: block;
        }
        
        .refresh-btn {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .refresh-btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .feature-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="settings-container">
        <div class="settings-header">
            <h1><i class="fas fa-cog"></i> Settings & Backend Configuration</h1>
            <div class="settings-header-actions">
                <button class="refresh-btn" onclick="refreshSettings()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <a href="/" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Chat
                </a>
            </div>
        </div>

        <div class="settings-grid">
            <!-- Backend Status -->
            <div class="settings-card">
                <h3><i class="fas fa-server"></i> Backend Status</h3>
                <div class="config-item">
                    <span class="config-label">Version</span>
                    <span class="config-value" id="backend-version">Loading...</span>
                </div>
                <div class="config-item">
                    <span class="config-label">Status</span>
                    <span class="status-badge status-online" id="backend-status">Online</span>
                </div>
                <div class="config-item">
                    <span class="config-label">Database Path</span>
                    <span class="config-value" id="database-path">Loading...</span>
                </div>
                <div class="config-item">
                    <span class="config-label">CORS Enabled</span>
                    <span class="status-badge status-enabled" id="cors-status">Yes</span>
                </div>
                <div class="config-item">
                    <span class="config-label">WebSocket Support</span>
                    <span class="status-badge status-enabled" id="websocket-status">Yes</span>
                </div>
            </div>

            <!-- Authentication -->
            <div class="settings-card">
                <h3><i class="fas fa-shield-alt"></i> Authentication</h3>
                <div class="config-item">
                    <span class="config-label">Authentication</span>
                    <span class="status-badge" id="auth-status">Loading...</span>
                </div>
                <div class="config-item" id="username-item" style="display: none;">
                    <span class="config-label">Username</span>
                    <span class="config-value" id="auth-username">-</span>
                </div>
                <div class="config-item">
                    <span class="config-label">Security Level</span>
                    <span class="config-value" id="security-level">Basic HTTP Auth</span>
                </div>
            </div>

            <!-- Available Bots -->
            <div class="settings-card">
                <h3><i class="fas fa-robot"></i> Available AI Bots</h3>
                <div class="config-item">
                    <span class="config-label">Total Bots</span>
                    <span class="config-value" id="total-bots">Loading...</span>
                </div>
                <div class="bot-list" id="bot-list">
                    <div style="text-align: center; color: #666;">Loading bots...</div>
                </div>
            </div>

            <!-- Features -->
            <div class="settings-card">
                <h3><i class="fas fa-puzzle-piece"></i> Enabled Features</h3>
                <div class="feature-grid" id="features-grid">
                    <div style="text-align: center; color: #666;">Loading features...</div>
                </div>
            </div>
        </div>

        <!-- API Endpoints -->
        <div class="settings-card">
            <h3><i class="fas fa-code"></i> Available API Endpoints</h3>
            <div class="config-item">
                <span class="config-label">API Base URL</span>
                <span class="config-value" id="api-base-url">{{ request.url.scheme }}://{{ request.url.netloc }}</span>
            </div>
            <div style="margin-top: 15px;" id="api-endpoints">
                <div style="text-align: center; color: #666;">Loading endpoints...</div>
            </div>
        </div>
    </div>

    <script>
        async function loadSettings() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                
                // Backend Status
                document.getElementById('backend-version').textContent = config.backend_version || 'Unknown';
                document.getElementById('database-path').textContent = config.database_path || 'Unknown';
                
                // Authentication
                const authEnabled = config.authentication_enabled;
                const authStatus = document.getElementById('auth-status');
                const usernameItem = document.getElementById('username-item');
                
                if (authEnabled) {
                    authStatus.textContent = 'Enabled';
                    authStatus.className = 'status-badge status-enabled';
                    usernameItem.style.display = 'flex';
                    document.getElementById('auth-username').textContent = config.username || 'Hidden';
                } else {
                    authStatus.textContent = 'Disabled';
                    authStatus.className = 'status-badge status-disabled';
                }
                
                // Bots
                document.getElementById('total-bots').textContent = config.total_bots || 0;
                const botList = document.getElementById('bot-list');
                if (config.available_bots && config.available_bots.length > 0) {
                    botList.innerHTML = config.available_bots.map(bot => 
                        `<div class="bot-item"><i class="fas fa-robot"></i> ${bot}</div>`
                    ).join('');
                } else {
                    botList.innerHTML = '<div style="text-align: center; color: #666;">No bots available</div>';
                }
                
                // Features
                const featuresGrid = document.getElementById('features-grid');
                if (config.features) {
                    featuresGrid.innerHTML = Object.entries(config.features).map(([key, value]) => {
                        const statusClass = value ? 'status-enabled' : 'status-disabled';
                        const statusText = value ? 'Yes' : 'No';
                        const featureName = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                        
                        return `
                            <div class="feature-item">
                                <span class="feature-name">${featureName}</span>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                        `;
                    }).join('');
                } else {
                    featuresGrid.innerHTML = '<div style="text-align: center; color: #666;">No features data</div>';
                }
                
                // API Endpoints
                const endpointsDiv = document.getElementById('api-endpoints');
                if (config.api_endpoints) {
                    endpointsDiv.innerHTML = config.api_endpoints.map(endpoint => 
                        `<code class="api-endpoint">${endpoint}</code>`
                    ).join('');
                } else {
                    endpointsDiv.innerHTML = '<div style="text-align: center; color: #666;">No endpoints data</div>';
                }
                
            } catch (error) {
                console.error('Failed to load settings:', error);
                document.body.innerHTML += `
                    <div style="background: #f8d7da; color: #721c24; padding: 15px; margin: 20px; border-radius: 8px;">
                        <strong>Error loading settings:</strong> ${error.message}
                    </div>
                `;
            }
        }

        function refreshSettings() {
            // Show loading state
            const elements = ['backend-version', 'database-path', 'total-bots'];
            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = 'Loading...';
            });
            
            // Reload settings
            loadSettings();
        }

        // Load settings when page loads
        document.addEventListener('DOMContentLoaded', loadSettings);
    </script>
</body>
</html> 